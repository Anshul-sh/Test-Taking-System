<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>Display Webcam Stream</title>
 
<style>
#container {
	margin: 0px auto;
	width: 500px;
	height: 375px;
	border: 10px #333 solid;
}
#videoElement {
	width: 500px;
	height: 375px;
	background-color: #666;
}

</style>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/0.4.1/html2canvas.min.js"></script>
<script src="https://code.jquery.com/jquery-1.11.0.min.js"></script>
</head>

<body>
<div id="container">
	<video autoplay="true" id="videoElement"></video>
	<button id="snap" onclick="snap()">Snap Photo</button>
	<canvas id="canvas" width="640" height="480"></canvas>
	<button id="submit" onclick="sendImage()">Submit</button>
</div>

<script>
	var video = document.querySelector("#videoElement");
	if (navigator.mediaDevices.getUserMedia) 
	{
	  navigator.mediaDevices.getUserMedia({ video: true })
	    .then(function (stream) {
	      video.srcObject = stream;
	    })
	    .catch(function (err0r) {
	      console.log("Something went wrong!");
	    });
	}
  var canvas=document.querySelector('canvas');
  var context=canvas.getContext('2d');
  var w,h,ratio;

  video.addEventListener('loadedmetadata', function() {
    ratio = video.videoWidth/video.videoHeight;
    w = video.videoWidth-100;
    h = parseInt(w/ratio,10);
    canvas.width = w;
    canvas.height = h;
  },false);

  function snap() {
    context.fillRect(0,0,w,h);
    context.drawImage(video,0,0,w,h);
  }


  function sendImage() {
	image_data = canvas.toDataURL('image/jpg'); //  use can use image/jpg to generate JPG format image
    var block = image_data.split(";");
    var contentType = block[0].split(":")[1]
    var realData = block[1].split(",")[1];
	alert("I am an alert box!");
    var blob = b64toBlob(realData, contentType);
    var formData = new FormData();
    formData.append("screenshot", blob, 'screenshot.png');

      $.ajax({
            url: "/faceid/",
            type: "POST",
            timeout: 0,
            processData: false,
            mimeType: "multipart/form-data",
            contentType: false,
            data: formData,
            dataType:"json",
            success: function (data) {
                   alert("Image successfully send!");
            },
            error: function (e) {
                console.log(e);
            }
            }).done(function(o) {

           });
  }
</script>
</body>
</html>

